{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { createContext, useState } from \"react\";\nimport { useNavigation } from \"@react-navigation/native\";\nimport axios from 'axios';\nimport to from 'await-to-js';\nimport firebase from \"../services/FIrebaseConnection\";\nimport { endAsyncEvent } from \"react-native/Libraries/Performance/Systrace\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport var AuthContext = createContext({});\nfunction AuthProvider(_ref) {\n  var children = _ref.children;\n  var _useState = useState(null),\n    _useState2 = _slicedToArray(_useState, 2),\n    user = _useState2[0],\n    setUser = _useState2[1];\n  var _useState3 = useState('Teste'),\n    _useState4 = _slicedToArray(_useState3, 2),\n    usuarioLogado = _useState4[0],\n    setUsuarioLogado = _useState4[1];\n  var _useState5 = useState(false),\n    _useState6 = _slicedToArray(_useState5, 2),\n    loadingAuth = _useState6[0],\n    setLoadingAuth = _useState6[1];\n  var navigation = useNavigation();\n  function signUp(_x, _x2, _x3) {\n    return _signUp.apply(this, arguments);\n  }\n  function _signUp() {\n    _signUp = _asyncToGenerator(function* (email, password, user) {\n      setLoadingAuth(true);\n      var _yield$to = yield to(axios.post('http://localhost:3000/unauth/register', {\n          userName: user,\n          email: email,\n          password: password\n        })),\n        _yield$to2 = _slicedToArray(_yield$to, 2),\n        error = _yield$to2[0],\n        usuario = _yield$to2[1];\n      console.log({\n        usuario: usuario\n      });\n      if (error) {\n        console.log(error);\n        setLoadingAuth(false);\n        throw new Error(\"Erro ao efetuar Cadastro\", error);\n      }\n      setUsuarioLogado(usuario == null ? void 0 : usuario.userName);\n      setLoadingAuth(false);\n      navigation.goBack();\n    });\n    return _signUp.apply(this, arguments);\n  }\n  function singOut() {\n    return _singOut.apply(this, arguments);\n  }\n  function _singOut() {\n    _singOut = _asyncToGenerator(function* () {\n      yield AsyncStorage.clear().then(function () {\n        setUser(null);\n      });\n    });\n    return _singOut.apply(this, arguments);\n  }\n  function signIn(_x4, _x5) {\n    return _signIn.apply(this, arguments);\n  }\n  function _signIn() {\n    _signIn = _asyncToGenerator(function* (email, password) {\n      setLoadingAuth(true);\n      var usuario = firebase.auth().signInWithEmailAndPassword(email, password).then(function (usuario) {\n        function capturaDados() {\n          return _capturaDados.apply(this, arguments);\n        }\n        function _capturaDados() {\n          _capturaDados = _asyncToGenerator(function* () {\n            yield firebase.database().ref('usuarios').child(usuario.user.uid).child('nome').get().then(function (snapshot) {\n              if (snapshot.exists()) {\n                var nomeUsuario = snapshot.val();\n                console.log(snapshot.val());\n                setUsuarioLogado(nomeUsuario);\n              } else {\n                console.log(\"No data available\");\n              }\n              setUser(usuario.user.uid);\n              setLoadingAuth(false);\n            });\n          });\n          return _capturaDados.apply(this, arguments);\n        }\n        capturaDados();\n      }).catch(function (err) {\n        alert('Usuário ou senha incorretos!');\n        setLoadingAuth(false);\n      });\n    });\n    return _signIn.apply(this, arguments);\n  }\n  return _jsx(AuthContext.Provider, {\n    value: {\n      signed: !!user,\n      user: user,\n      signUp: signUp,\n      singOut: singOut,\n      signIn: signIn,\n      loadingAuth: loadingAuth,\n      usuarioLogado: usuarioLogado\n    },\n    children: children\n  });\n}\nexport default AuthProvider;","map":{"version":3,"names":["React","createContext","useState","useNavigation","axios","to","firebase","endAsyncEvent","jsx","_jsx","AuthContext","AuthProvider","_ref","children","_useState","_useState2","_slicedToArray","user","setUser","_useState3","_useState4","usuarioLogado","setUsuarioLogado","_useState5","_useState6","loadingAuth","setLoadingAuth","navigation","signUp","_x","_x2","_x3","_signUp","apply","arguments","_asyncToGenerator","email","password","_yield$to","post","userName","_yield$to2","error","usuario","console","log","Error","goBack","singOut","_singOut","AsyncStorage","clear","then","signIn","_x4","_x5","_signIn","auth","signInWithEmailAndPassword","capturaDados","_capturaDados","database","ref","child","uid","get","snapshot","exists","nomeUsuario","val","catch","err","alert","Provider","value","signed"],"sources":["C:/Users/h264m/OneDrive/Documents/FATEC/TG/projeto inicial/meuApp/src/contexts/auth.js"],"sourcesContent":["import React, { createContext, useState } from \"react\";\r\nimport { useNavigation } from \"@react-navigation/native\";\r\n\r\nimport axios from 'axios';\r\nimport to from 'await-to-js'\r\nimport firebase from \"../services/FIrebaseConnection\";\r\nimport { endAsyncEvent } from \"react-native/Libraries/Performance/Systrace\";\r\n\r\nexport const AuthContext = createContext({});\r\n\r\nfunction AuthProvider({ children }) {\r\n    const [user, setUser] = useState(null);\r\n    const [usuarioLogado, setUsuarioLogado] = useState('Teste')\r\n    const [loadingAuth, setLoadingAuth] = useState(false);\r\n\r\n    const navigation = useNavigation();\r\n\r\n    async function signUp(email, password, user) {\r\n        setLoadingAuth(true);\r\n        const [error, usuario] = await to(axios.post('http://localhost:3000/unauth/register',\r\n        { userName: user, email, password },\r\n        ))\r\n        console.log({usuario})\r\n        if(error){\r\n            console.log(error)\r\n            setLoadingAuth(false);\r\n            throw new Error(\"Erro ao efetuar Cadastro\", error)\r\n        }\r\n        setUsuarioLogado(usuario?.userName)\r\n        setLoadingAuth(false);\r\n        navigation.goBack();\r\n    }\r\n\r\n    async function singOut() {\r\n        await AsyncStorage.clear()\r\n            .then(() => { setUser(null); })\r\n    }\r\n\r\n\r\n    async function signIn(email, password) {\r\n        setLoadingAuth(true);\r\n\r\n\r\n\r\n        const usuario = firebase.auth().signInWithEmailAndPassword(email, password)\r\n            .then((usuario) => {\r\n\r\n                async function capturaDados() {\r\n\r\n                    await firebase.database().ref('usuarios').child(usuario.user.uid).child('nome').get().then((snapshot) => {\r\n                        if (snapshot.exists()) {\r\n                            const nomeUsuario = (snapshot.val())\r\n                            console.log(snapshot.val());\r\n                            setUsuarioLogado(nomeUsuario);\r\n\r\n                        } else {\r\n                            console.log(\"No data available\");\r\n                        }\r\n                        setUser(usuario.user.uid)\r\n                        setLoadingAuth(false);\r\n                    \r\n                    })\r\n\r\n                }\r\n                // alert(idUsuario)\r\n\r\n                capturaDados();\r\n\r\n            })\r\n            .catch((err) => {\r\n                alert('Usuário ou senha incorretos!')\r\n                setLoadingAuth(false);\r\n            })\r\n\r\n    }\r\n    return (\r\n        <AuthContext.Provider value={{ signed: !!user, user, signUp, singOut, signIn, loadingAuth, usuarioLogado }}>\r\n            {children}\r\n        </AuthContext.Provider>\r\n    )\r\n}\r\n\r\nexport default AuthProvider;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}